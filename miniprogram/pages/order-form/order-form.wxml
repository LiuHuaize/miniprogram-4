<view class="page">
  <view class="status-spacer"></view>

  <view class="nav-bar">
    <view class="nav-left" bindtap="onBack">
      <view class="nav-icon-wrap">
        <t-icon name="chevron-left" size="32rpx" />
      </view>
      <text class="nav-text">返回</text>
    </view>
    <text class="nav-title">订单详情</text>
    <view class="nav-right">
      <view class="nav-action">
        <t-icon name="ellipsis" size="32rpx" />
      </view>
    </view>
  </view>

  <scroll-view class="scroll-area" scroll-y show-scrollbar="{{false}}">
    <view class="card summary-card">
      <image
        class="summary-thumb"
        mode="aspectFill"
        src="{{posterUrls['/assets/poster/01-cover.png']}}"
        data-src="{{posterUrls['/assets/poster/01-cover.png']}}"
        binderror="onImageError"
      />
      <view class="summary-main">
        <text class="summary-title">{{summary.title}}</text>
        <text class="summary-sub">{{summary.sub}}</text>
      </view>
      <text class="summary-price">{{summary.price}}</text>
    </view>

    <view class="card period-card" bindtap="onChoosePeriod">
      <view class="period-left">
        <text class="period-label">期数</text>
        <text class="period-value">{{periods[selectedPeriodIndex].name}}（{{periods[selectedPeriodIndex].date}}）</text>
      </view>
      <t-icon name="chevron-right" size="28rpx" />
    </view>

    <view class="section">
      <view class="section-title">营员数量</view>
      <view class="card count-card">
        <view class="count-row">
          <text class="count-label">营员数量</text>
          <view class="count-stepper">
            <view class="step-btn {{campers.length <= 1 ? 'disabled' : ''}}" data-type="minus" bindtap="onChangeCount">-</view>
            <text class="step-value">{{campers.length}}</text>
            <view class="step-btn {{campers.length >= maxCampers ? 'disabled' : ''}}" data-type="plus" bindtap="onChangeCount">+</view>
          </view>
        </view>
      </view>
    </view>

    <view class="section">
      <view class="section-title">营员信息</view>
      <view
        class="card camper-card"
        wx:for="{{campers}}"
        wx:key="index"
        data-index="{{index}}"
        bindtap="onOpenCamper"
      >
        <view class="camper-left">
          <text class="camper-title">营员{{index + 1}}</text>
          <text class="camper-sub">{{item.name || '选择营员'}}</text>
        </view>
        <t-icon name="chevron-right" size="28rpx" />
      </view>
    </view>

    <view class="section">
      <view class="section-title">监护人信息</view>
      <view class="card form-card">
        <view class="field-row">
          <view class="field-label">监护人姓名</view>
          <view class="field-value">
            <t-input
              class="field-input"
              placeholder="请输入"
              borderless
              align="left"
              value="{{guardian.name}}"
              bindchange="onGuardianNameChange"
            />
          </view>
        </view>
        <view class="field-row">
          <view class="field-label">监护人身份证号</view>
          <view class="field-value">
          <t-input
            class="field-input"
            placeholder="{{guardian.idNoMask ? '已保存，重新输入以修改' : '请输入'}}"
            borderless
            align="left"
            type="idcard"
              value="{{guardian.idNo}}"
              bindchange="onGuardianIdChange"
            />
          </view>
        </view>
        <view class="field-row">
          <view class="field-label">监护人手机号</view>
          <view class="field-value">
            <t-input
              class="field-input"
              placeholder="请输入"
              borderless
              align="left"
              type="number"
              value="{{guardian.phone}}"
              bindchange="onGuardianPhoneChange"
            />
          </view>
        </view>
        <view class="field-row field-row--last">
          <view class="field-label">监护人微信号</view>
          <view class="field-value">
            <t-input
              class="field-input"
              placeholder="请输入"
              borderless
              align="left"
              value="{{guardian.wechat}}"
              bindchange="onGuardianWechatChange"
            />
          </view>
        </view>
      </view>
    </view>
  </scroll-view>

  <view class="bottom-bar">
    <view class="bottom-left">
      <text class="bottom-label">活动费用</text>
      <text class="bottom-price">{{summary.price}}</text>
    </view>
    <t-button class="submit-btn" theme="primary" shape="round" size="small" bindtap="onSubmit">提交订单</t-button>
  </view>

  <view class="period-mask" wx:if="{{periodPopupVisible}}" bindtap="onClosePeriods">
    <view class="period-sheet" catchtap>
      <view class="period-head">
        <view class="period-top">
          <text class="period-title">少年独角兽 AI 创业营 2026</text>
          <text class="period-price">{{summary.price}}</text>
        </view>
        <view class="period-sub">报名截止：{{periods[selectedPeriodIndex].deadline}}</view>
        <text class="period-quota">{{periods[selectedPeriodIndex].quota}}</text>
      </view>
      <view class="period-section-title">期数选择</view>
      <view class="period-list">
        <view
          class="period-item {{selectedPeriodIndex === index ? 'active' : ''}}"
          wx:for="{{periods}}"
          wx:key="id"
          data-index="{{index}}"
          bindtap="onSelectPeriod"
        >
          <text>{{item.name}}（{{item.date}}）</text>
        </view>
      </view>
      <t-button class="period-confirm" theme="primary" shape="round" size="small" bindtap="onConfirmPeriod">确认</t-button>
    </view>
  </view>

  <view class="home-indicator"></view>
</view>
